# План реализации проекта "Bank" - Система общения бизнеса и клиентов

## Технологический стек (определено)

- **Backend:** Node.js + Express (JavaScript)
- **Frontend:** Vue 3 + Composition API
- **База данных:** MongoDB
- **Интеграция:** mms3 API + RabbitMQ
- **Push-уведомления:** будут реализованы (сервис выберем позже)
- **Структура:** монорепо
- **Приложение:** PWA (Progressive Web App)

## Ответы на основные вопросы

1. ✅ **Технологический стек:** Node.js (backend) + Vue.js (frontend)
2. ⏳ **SMS-сервис:** будет определен позже
3. ⏳ **Хранение файлов:** будет определено позже
4. ✅ **Канал бизнеса:** отдельный диалог в mms3
5. ⏳ **Бот бизнеса:** логика будет описана позже
6. ✅ **Права доступа:** система ролей нужна (детали уточняются)
7. ✅ **База данных:** MongoDB
8. ⏳ **Аутентификация:** будет реализована позже
9. ✅ **Slug для бизнеса:** уникальный глобально
10. ✅ **Уведомления:** push-уведомления будут реализованы

## Ответы на дополнительные вопросы

11. ✅ **Backend:** JavaScript, Express
12. ✅ **Frontend:** Vue 3, Composition API
13. ✅ **Структура:** монорепо (backend/, frontend/)
14. ✅ **Роли:** владелец один (проработаем позже)
15. ✅ **Канал:** публиковать может владелец, подписаться могут все
16. ✅ **Поиск:** публичная ссылка, QR-код, каталог по категориям и геолокации
17. ⏳ **Управление диалогами:** проработаем позже
18. ✅ **Push-уведомления:** сервис выберем позже, админ-панель нужна, PWA
25. ✅ **UI-фреймворк:** свой дизайн
26. ✅ **Категории:** да, каталог будет
27. ⏳ **Управление каталогом:** проработаем позже
30. ✅ **Админ-панель:** контроль, статистика
31. ✅ **Структура монорепо:** backend/, frontend/
32. ✅ **Мультитенантность:** один тенант
33. ✅ **Локализация:** пока не нужна
34. ✅ **Канал:** подписаться могут все пользователи

## Дополнительные вопросы

## Финальные вопросы для уточнения

### 25. **UI-фреймворк для Vue 3:**
   - Какой UI-фреймворк использовать? (Vuetify, Element Plus, Quasar, PrimeVue, или свой)
   - Или без фреймворка, свой дизайн?

### 26. **Категории бизнесов:**
   - Кто создает категории? (админ или владельцы при создании бизнеса?)
   - Предустановленный список или пользовательские категории?
   - Может ли бизнес быть в нескольких категориях?

### 27. **Геолокация:**
   - Как указывается местоположение? (координаты при создании бизнеса?)
   - Нужен ли адрес или только координаты?
   - Радиус поиска "бизнесов рядом"? (по умолчанию)
   - Нужна ли карта для отображения?

### 28. **QR-код:**
   - Что кодируется в QR? (прямая ссылка на бизнес, slug, или специальный код?)
   - Где генерируется? (при создании бизнеса или по запросу?)
   - Нужна ли возможность скачать QR-код в разных форматах?

### 29. **Публичная страница бизнеса:**
   - Что должно быть на странице? (название, описание, логотип, канал, кнопка "Написать"?)
   - Нужна ли статистика на публичной странице? (количество подписчиков, отзывы?)
   - Может ли владелец скрыть бизнес из каталога, но оставить публичную ссылку?

### 30. **Админ-панель:**
   - Какие функции в админ-панели?
     - Управление пользователями?
     - Управление бизнесами?
     - Управление категориями?
     - Статистика и аналитика?
     - Модерация контента?
   - Кто имеет доступ к админ-панели? (отдельные админ-аккаунты?)

### 31. **Структура монорепо:**
   - Как организовать структуру? (папки `backend/` и `frontend/`?)
   - Использовать ли npm/yarn workspaces?
   - Общие типы/константы между backend и frontend?

### 32. **Мультитенантность:**
   - Один тенант для всех пользователей или нужна поддержка нескольких организаций?

### 33. **Локализация:**
   - Нужна ли поддержка нескольких языков?
   - Какие языки приоритетны? (русский, английский?)

### 34. **Канал бизнеса (детали):**
   - Кто может подписаться на канал? (любой пользователь или только те, кто уже общался с бизнесом?)
   - Могут ли клиенты комментировать сообщения в канале?
   - Могут ли клиенты реагировать на сообщения в канале?

### 35. **Slug и валидация:**
   - Какой формат slug? (только латиница, цифры, дефисы?)
   - Минимальная/максимальная длина?
   - Что делать, если slug занят? (предложить варианты, добавить суффикс?)

---

## Основные понятия и сущности

### 1. Пользователь (User)
- **Регистрация:** по номеру телефона
- **Авторизация:** SMS-код
- **Профиль:**
  - Имя (name) - редактируемое
  - Аватар (avatar) - с инициалами или последние 2 цифры телефона
  - Номер телефона (phone) - неизменяемый
  - ID пользователя (userId) - уникальный
  - Дата регистрации (createdAt)
  - Дата последнего входа (lastLoginAt)
- **Страница профиля:** `/profile` (требует авторизации)
  - Отображение информации о пользователе
  - Редактирование имени
  - Статистика: количество бизнесов и подписок
  - Ссылки на "Мои бизнесы" и "Мои подписки"
- **Навигация:** ссылки на профиль из всех основных страниц

### 2. Бизнес (Business)
- **Владелец:** пользователь (User)
- **Атрибуты:**
  - Название (name)
  - Описание (description)
  - Логотип (logo)
  - Slug (уникальный идентификатор для URL, глобально уникальный)
  - Владелец (ownerId - ссылка на User)
  - Дата создания (createdAt)
  - Дата обновления (updatedAt)
- **Связи:**
  - Один пользователь может иметь несколько бизнесов
  - Бизнес может иметь несколько участников с разными ролями
  - Каждый бизнес имеет одного основного владельца

### 3. Бот бизнеса (Business Bot)
- **Тип:** пользователь типа "bot" в mms3
- **Связь:** привязан к бизнесу
- **Функции:**
  - Прием сообщений от клиентов
  - Автоматические ответы (настраиваемые)
  - Приглашение владельца для ответа
  - Передача сообщений владельцу

### 4. Канал бизнеса (Business Channel)
- **Тип:** отдельный диалог в mms3
- **Участники:**
  - Бот бизнеса
  - Подписчики канала (клиенты)
- **Функции:**
  - Публикация сообщений от бизнеса (владелец, менеджеры с правами)
  - Лента сообщений для клиентов
  - Возможность реакции/комментариев (настраивается)

### 6. Участник бизнеса (Business Member)
- **Роли:**
  - `owner` - владелец (полный доступ)
  - `manager` - менеджер (может отвечать, публиковать в канал, управлять участниками)
  - `operator` - оператор (может отвечать на сообщения)
  - `viewer` - наблюдатель (только просмотр)
- **Права:**
  - `canReply` - отвечать на сообщения
  - `canPublishChannel` - публиковать в канал
  - `canManageMembers` - управлять участниками
  - `canManageSettings` - управлять настройками

### 5. Диалог клиент-бот (Client-Bot Dialog)
- **Тип:** диалог в mms3
- **Участники:**
  - Клиент (User)
  - Бот бизнеса (Bot)
  - Владелец бизнеса (опционально, при приглашении)
- **Функции:**
  - Общение клиента с бизнесом
  - Бот может отвечать автоматически
  - Владелец может подключиться для ответа

---

## Архитектура системы

### Компоненты

1. **API Gateway / Backend Service**
   - Аутентификация пользователей
   - Управление профилями
   - Управление бизнесами
   - Интеграция с mms3 API
   - Управление ботами

2. **SMS Service**
   - Отправка SMS-кодов
   - Валидация кодов
   - Rate limiting

3. **File Storage Service**
   - Загрузка аватаров
   - Загрузка логотипов
   - CDN для раздачи файлов

4. **Bot Service**
   - Обработка сообщений от клиентов
   - Автоматические ответы
   - Логика приглашения владельца

5. **Channel Service**
   - Управление каналами бизнесов
   - Публикация в каналы
   - Подписка на каналы

6. **Integration with mms3**
   - Создание пользователей в mms3
   - Создание диалогов
   - Создание ботов
   - Обработка событий через RabbitMQ
   - Отправка сообщений

---

## Структура базы данных

### Коллекции (MongoDB)

#### users
```javascript
{
  _id: ObjectId,
  userId: String,           // Уникальный ID (может быть phone или сгенерированный)
  phone: String,           // Номер телефона (уникальный)
  name: String,            // Имя пользователя
  avatar: String,          // URL аватара
  createdAt: Date,
  updatedAt: Date,
  lastLoginAt: Date,
  isActive: Boolean
}
```

#### businesses
```javascript
{
  _id: ObjectId,
  businessId: String,      // Уникальный ID
  ownerId: String,         // userId владельца (основного)
  name: String,            // Название бизнеса
  description: String,     // Описание
  logo: String,            // URL логотипа
  slug: String,            // Уникальный slug (глобально)
  categoryIds: [String],   // Массив ID категорий
  location: {
    address: String,        // Адрес (опционально)
    coordinates: {
      lat: Number,         // Широта
      lng: Number          // Долгота
    }
  },
  qrCode: String,          // URL QR-кода или данные для генерации
  isPublic: Boolean,       // Виден ли в каталоге
  mms3BotId: String,       // userId бота в mms3
  mms3ChannelDialogId: String, // dialogId канала в mms3
  createdAt: Date,
  updatedAt: Date,
  isActive: Boolean
}
```

#### categories
```javascript
{
  _id: ObjectId,
  categoryId: String,      // Уникальный ID
  name: String,           // Название категории
  slug: String,           // Slug категории
  icon: String,           // Иконка (URL или название)
  parentId: String,       // ID родительской категории (для вложенности)
  order: Number,          // Порядок сортировки
  createdAt: Date,
  updatedAt: Date,
  isActive: Boolean
}
```

#### business_members
```javascript
{
  _id: ObjectId,
  businessId: String,      // Ссылка на бизнес
  userId: String,          // userId участника
  role: String,            // owner, manager, operator, viewer
  permissions: {
    canReply: Boolean,    // Может отвечать на сообщения
    canPublishChannel: Boolean, // Может публиковать в канал
    canManageMembers: Boolean,  // Может управлять участниками
    canManageSettings: Boolean // Может управлять настройками
  },
  invitedBy: String,      // userId пригласившего
  invitedAt: Date,
  joinedAt: Date,
  isActive: Boolean
}
```

#### sms_codes
```javascript
{
  _id: ObjectId,
  phone: String,           // Номер телефона
  code: String,           // SMS-код
  expiresAt: Date,        // Время истечения
  attempts: Number,       // Количество попыток
  createdAt: Date,
  usedAt: Date            // Когда был использован
}
```

#### business_settings
```javascript
{
  _id: ObjectId,
  businessId: String,
  autoReplyEnabled: Boolean,
  autoReplyMessage: String,
  inviteOwnerOnKeywords: [String], // Ключевые слова для приглашения владельца
  channelSettings: {
    allowComments: Boolean,      // Разрешить комментарии в канале
    allowReactions: Boolean,     // Разрешить реакции в канале
    moderationEnabled: Boolean   // Модерация сообщений
  },
  createdAt: Date,
  updatedAt: Date
}
```

#### push_tokens
```javascript
{
  _id: ObjectId,
  userId: String,          // userId пользователя
  token: String,          // Push токен (FCM, OneSignal, и т.д.)
  platform: String,       // web, ios, android
  deviceId: String,        // Уникальный ID устройства (опционально)
  preferences: {
    newMessage: Boolean,   // Уведомления о новых сообщениях
    channelUpdate: Boolean, // Уведомления об обновлениях канала
    mentions: Boolean      // Уведомления об упоминаниях
  },
  createdAt: Date,
  updatedAt: Date,
  lastUsedAt: Date
}
```

---

## API Endpoints (предварительная структура)

### Аутентификация
- `POST /api/auth/send-code` - Отправить SMS-код
- `POST /api/auth/verify-code` - Проверить код и получить токен
- `POST /api/auth/refresh` - Обновить токен
- `POST /api/auth/logout` - Выход

### Пользователи
- `GET /api/users/:userId` - Получить пользователя по ID
- `PUT /api/users/:userId` - Обновить профиль (требует авторизации, только свой профиль)
- `POST /api/users/:userId/avatar` - Загрузить аватар (требует авторизации, только свой профиль)

**Требования к UI:**
- Страница "Мой профиль" (`/profile`) - отображение и редактирование профиля пользователя
- Отображение информации: имя, телефон, ID пользователя
- Аватар с инициалами (или последние 2 цифры телефона, если имени нет)
- Форма редактирования имени
- Кнопка "Изменить аватар" (заглушка для будущей реализации)
- Статистика: количество бизнесов и подписок
- Ссылки на "Мои бизнесы" и "Мои подписки" из профиля
- Ссылки на профиль из:
  - Страницы "Мои бизнесы" (ссылка "Мой профиль →")
  - Страницы "Мои подписки" (ссылка "Мой профиль →")
  - Страницы "Каталог" (ссылка "Мой профиль →", только для авторизованных)
  - Главной страницы (имя пользователя кликабельно)
- Проверка прав доступа: редактировать можно только свой профиль

### Бизнесы
- `GET /api/businesses` - Список бизнесов (с фильтром ownerId)
- `GET /api/businesses/:id` - Получить бизнес
- `GET /api/businesses/slug/:slug` - Получить бизнес по slug (публичный)
- `POST /api/businesses` - Создать бизнес (требует авторизации)
- `PUT /api/businesses/:id` - Обновить бизнес (требует авторизации, только владелец)
- `DELETE /api/businesses/:id` - Удалить бизнес
- `POST /api/businesses/:id/logo` - Загрузить логотип
- `GET /api/businesses/:id/members` - Список участников бизнеса
- `POST /api/businesses/:id/members` - Добавить участника
- `PUT /api/businesses/:id/members/:userId` - Обновить роль участника
- `DELETE /api/businesses/:id/members/:userId` - Удалить участника

**Требования к UI:**
- Пользователь должен видеть список своих бизнесов на странице "Мои бизнесы"
- Возможность редактировать бизнес: название, описание, slug
- Валидация slug при редактировании (только латиница, цифры, дефисы)
- Предупреждение при изменении slug (влияет на публичную ссылку)
- Проверка прав доступа: редактировать может только владелец бизнеса

### Боты
- `GET /api/businesses/:id/bot` - Получить информацию о боте
- `PUT /api/businesses/:id/bot/settings` - Настроить бота

### Каналы
- `GET /api/businesses/:id/channel` - Получить канал бизнеса
- `POST /api/businesses/:id/channel/messages` - Опубликовать в канал (только владелец)
- `GET /api/businesses/:id/channel/messages` - Получить сообщения канала
- `POST /api/businesses/:id/channel/subscribe` - Подписаться на канал
- `DELETE /api/businesses/:id/channel/subscribe` - Отписаться от канала

### Подписки
- `POST /api/businesses/:businessId/subscribe` - Подписаться на бизнес (требует авторизации)
- `DELETE /api/businesses/:businessId/subscribe` - Отписаться от бизнеса (требует авторизации)
- `GET /api/me/subscriptions` - Получить мои подписки (требует авторизации)
- `GET /api/businesses/:businessId/subscribers` - Получить подписчиков бизнеса (требует авторизации, только владелец)

**Требования к UI:**
- Страница "Мои подписки" - список бизнесов, на которые подписан пользователь
- Страница "Каталог" - все публичные бизнесы с возможностью подписки
- Поиск по каталогу (по названию и описанию)
- Отображение статуса подписки в каталоге
- Публичная страница бизнеса по slug с возможностью подписки

### Каталог и поиск
- `GET /api/catalog` - Каталог бизнесов (с фильтрами по категориям, геолокации)
- `GET /api/catalog/categories` - Список категорий
- `GET /api/businesses/slug/:slug` - Публичная страница бизнеса по slug
- `GET /api/businesses/:id/qr` - Получить/сгенерировать QR-код бизнеса
- `GET /api/businesses/nearby` - Бизнесы рядом (по координатам и радиусу)

### Админ-панель
- `GET /api/admin/users` - Список пользователей
- `GET /api/admin/businesses` - Список всех бизнесов
- `GET /api/admin/categories` - Управление категориями
- `POST /api/admin/categories` - Создать категорию
- `PUT /api/admin/categories/:id` - Обновить категорию
- `DELETE /api/admin/categories/:id` - Удалить категорию
- `GET /api/admin/stats` - Статистика системы

### Диалоги
- `GET /api/dialogs` - Список диалогов пользователя
- `GET /api/dialogs/:id` - Получить диалог
- `GET /api/dialogs/:id/messages` - Получить сообщения диалога
- `POST /api/dialogs/:id/messages` - Отправить сообщение
- `POST /api/businesses/:id/start-dialog` - Начать диалог с бизнесом
- `GET /api/businesses/:id/dialogs` - Список диалогов бизнеса (для владельца/менеджера)
- `PUT /api/dialogs/:id/archive` - Архивировать диалог

### Push-уведомления
- `POST /api/push/register` - Зарегистрировать push токен
- `DELETE /api/push/unregister` - Удалить push токен
- `PUT /api/push/preferences` - Обновить настройки уведомлений

---

## Интеграция с mms3

### Создание пользователя в mms3
При регистрации пользователя в нашей системе:
1. Создаем пользователя через `POST /api/users` в mms3
2. Сохраняем `userId` из mms3 в нашей БД

### Создание бота
При создании бизнеса:
1. Создаем пользователя типа "bot" в mms3 через `POST /api/users`
2. Сохраняем `userId` бота в `businesses.mms3BotId`

### Создание канала
При создании бизнеса:
1. Создаем диалог в mms3 через `POST /api/dialogs`
2. Добавляем бота как участника
3. Сохраняем `dialogId` в `businesses.mms3ChannelDialogId`
4. В meta диалога указываем `type: "business_channel"`

### Создание диалога клиент-бот
Когда клиент начинает диалог с бизнесом:
1. Проверяем, существует ли уже диалог между клиентом и ботом
2. Если нет - создаем диалог через `POST /api/dialogs`
3. Добавляем клиента и бота как участников
4. В meta диалога указываем `type: "client_bot"`, `businessId: "..."`

### Обработка событий
Подписываемся на события mms3 через RabbitMQ:
- `message.create.*` - новые сообщения
- `dialog.member.add.*` - добавление участников
- `message.status.update.*` - статусы сообщений

---

## Структура монорепо

```
bank/
├── backend/              # Node.js + Express backend
│   ├── src/
│   │   ├── config/      # Конфигурация
│   │   ├── models/      # MongoDB модели
│   │   ├── routes/      # API routes
│   │   ├── controllers/ # Контроллеры
│   │   ├── services/    # Бизнес-логика
│   │   ├── middleware/  # Middleware
│   │   ├── utils/       # Утилиты
│   │   └── app.js       # Главный файл приложения
│   ├── package.json
│   └── .env
├── frontend/            # Vue 3 + Composition API
│   ├── src/
│   │   ├── components/  # Vue компоненты
│   │   ├── views/       # Страницы
│   │   ├── composables/ # Composition API функции
│   │   ├── stores/       # State management (Pinia)
│   │   ├── router/      # Vue Router
│   │   ├── api/         # API клиент
│   │   └── main.js      # Точка входа
│   ├── public/          # Статические файлы
│   ├── package.json
│   └── vite.config.js   # Vite конфигурация
├── docs/                # Документация
│   ├── mms3/           # Документация mms3
│   ├── PLAN.md         # План проекта
│   └── IDEAS.md        # Идеи и предложения
├── package.json         # Root package.json (опционально для workspaces)
└── README.md
```

## Этапы реализации

### Этап 1: Базовая инфраструктура
- [ ] Настройка монорепо (структура папок, package.json workspaces)
- [ ] Настройка backend (Express, базовые middleware)
- [ ] Настройка frontend (Vue 3, Vite, базовые компоненты)
- [ ] Настройка подключения к MongoDB
- [ ] Настройка подключения к mms3 API
- [ ] Настройка RabbitMQ для событий
- [ ] Базовая конфигурация (.env файлы)

### Этап 2: Аутентификация
- [ ] SMS-сервис (отправка кодов)
- [ ] Валидация SMS-кодов
- [ ] Генерация JWT токенов
- [ ] Middleware для аутентификации
- [ ] Обновление токенов

### Этап 3: Управление пользователями
- [x] Регистрация пользователей
- [ ] Создание пользователя в mms3
- [x] Профиль пользователя (CRUD)
  - [x] Страница профиля (`/profile`)
  - [x] Отображение информации о пользователе
  - [x] Редактирование имени
  - [x] Аватар с инициалами
  - [x] Статистика (количество бизнесов и подписок)
  - [x] Ссылки на профиль из разных страниц
  - [ ] Загрузка аватаров (заглушка реализована)
- [x] Проверка прав доступа при редактировании профиля

### Этап 4: Управление бизнесами
- [x] Создание бизнеса
- [x] Валидация slug (уникальность, формат)
- [x] Обновление бизнеса
- [ ] Загрузка логотипов
- [x] Список бизнесов пользователя (UI)
- [x] Редактирование бизнеса в UI (название, описание, slug)
- [ ] Публичная страница бизнеса по slug
- [ ] Генерация QR-кода для бизнеса

### Этап 5: Интеграция с mms3 - Боты
- [ ] Создание бота при создании бизнеса
- [ ] Настройки бота
- [ ] Автоматические ответы

### Этап 6: Интеграция с mms3 - Каналы
- [ ] Создание канала при создании бизнеса
- [ ] Публикация в канал
- [ ] Подписка на канал
- [ ] Получение сообщений канала

### Этап 7: Интеграция с mms3 - Диалоги
- [ ] Создание диалога клиент-бот
- [ ] Отправка сообщений
- [ ] Получение сообщений
- [ ] Обработка событий через RabbitMQ

### Этап 8: Логика бота
- [ ] Обработка входящих сообщений
- [ ] Автоматические ответы
- [ ] Приглашение владельца
- [ ] Передача сообщений владельцу

### Этап 9: Каталог и поиск
- [x] Каталог бизнесов (`/catalog`)
  - [x] Список всех публичных бизнесов
  - [x] Поиск по названию и описанию (в реальном времени)
  - [x] Отображение статуса подписки
  - [x] Кнопка подписки/отписки
  - [x] Ссылка на публичную страницу бизнеса
  - [x] Ссылка на профиль пользователя
- [x] Страница "Мои подписки" (`/my-subscriptions`)
  - [x] Список бизнесов, на которые подписан пользователь
  - [x] Кнопка отписки с подтверждением
  - [x] Ссылка на публичную страницу бизнеса
  - [x] Ссылка на профиль пользователя
- [x] Публичная страница бизнеса (`/business/:slug`)
  - [x] Отображение информации о бизнесе
  - [x] Кнопка подписки (для авторизованных)
  - [x] Отображение статуса подписки
- [ ] Система категорий (CRUD для админа)
- [ ] Привязка бизнесов к категориям
- [ ] Геолокация бизнесов (координаты, адрес)
- [ ] Поиск бизнесов по категориям
- [ ] Поиск бизнесов по геолокации (рядом)
- [ ] Каталог бизнесов с фильтрами по категориям и геолокации

### Этап 10: Админ-панель
- [ ] Аутентификация админов
- [ ] Управление пользователями
- [ ] Управление бизнесами
- [ ] Управление категориями
- [ ] Статистика и аналитика
- [ ] Модерация контента (опционально)

### Этап 11: Дополнительные функции
- [ ] Push-уведомления (интеграция с выбранным сервисом)
- [ ] PWA настройка (манифест, service worker)
- [ ] Логирование
- [ ] Мониторинг

### Этап 12: Тестирование и оптимизация
- [ ] Unit тесты (backend)
- [ ] Unit тесты (frontend)
- [ ] Integration тесты
- [ ] E2E тесты
- [ ] Нагрузочное тестирование
- [ ] Оптимизация запросов
- [ ] Оптимизация производительности
- [ ] Документация API
- [ ] Документация для разработчиков

---

## Технические детали

### Безопасность
- Валидация всех входных данных
- Rate limiting для SMS
- Защита от брутфорса SMS-кодов
- JWT токены с истечением срока
- HTTPS для всех запросов
- Валидация файлов (тип, размер)

### Производительность
- Кэширование часто запрашиваемых данных
- Индексы в MongoDB
- Пагинация для списков
- Оптимизация запросов к mms3

### Масштабируемость
- Горизонтальное масштабирование
- Очереди для асинхронных задач
- Кэширование (Redis)
- CDN для статических файлов

---

## Заметки

- Все временные метки в формате ISO 8601 или Unix timestamp
- Все ID должны быть уникальными и предсказуемыми
- Использовать транзакции MongoDB где необходимо
- Логировать все важные операции
- Обрабатывать ошибки gracefully
